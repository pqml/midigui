!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.midigui=e()}(this,function(){"use strict";function n(n){return n=n||Object.create(null),{on:function(e,t){(n[e]||(n[e]=[])).push(t)},off:function(e,t){var o=n[e]||(n[e]=[]);o.splice(o.indexOf(t)>>>0,1)},emit:function(e,t){(n[e]||[]).map(function(n){n(t)}),(n["*"]||[]).map(function(n){n(e,t)})}}}function e(n,e){for(var t in e)n.style[t]=e[t]}function t(){var n=document.createElement("div");return e(n,{position:"fixed",top:"10px",left:"10px","z-index":"9999",background:l.background,color:l.primary,"font-family":"sans-serif",width:"300px","font-size":"11px"}),{dom:n}}function o(){var n=document.createElement("div");return e(n,{width:"100%",border:"none",color:l.background,padding:"10px","box-sizing":"border-box",background:l.highlight}),n.textContent="midigui",{dom:n}}function i(n){function t(){b=!0,u.style.background=l.recording}function o(){b=!1,u.style.background=l.background}function i(e){g=e,h.style.width=100*g+"%",a(n.name,Math.round(127*e))}function r(){var n="";n+=v?v.inputName+" - "+("noteOn"===v.event?"Note":"CC")+" "+v.pitch:"no input",p.textContent=n}function c(n){n.channel===v.channel&&n.pitch===v.pitch&&i(n.velocity/127)}function d(n,e,t,o){v&&v.bus&&v.bus.off(v.event,c),n.on(t,c),v={},v.bus=n,v.inputName=e,v.event=t,v.pitch=o.pitch,v.channel=o.channel,r(),c(o)}n=Object.assign({},f,n);var a=n.emit,u=document.createElement("div"),s=document.createElement("p"),p=document.createElement("p"),m=document.createElement("div"),h=document.createElement("div"),v=null,g=0,b=!1,y={dom:u,select:t,deselect:o,affect:d};return e(u,{background:l.background,"box-sizing":"border-box",padding:"10px 10px 20px 10px"}),e(s,{display:"inline-block","margin-right":"5px"}),e(p,{display:"inline-block",color:l.primary2}),e(m,{margin:"0",width:"100%",height:"1px",background:"rgba(255, 255, 255, 0.15)"}),e(h,{width:"10%",height:"100%",background:l.highlight}),u.addEventListener("mouseenter",function(){b||(u.style.background=l.background2),u.style.cursor="pointer"}),u.addEventListener("mouseleave",function(){b||(u.style.background=l.background)}),u.addEventListener("click",function(){n.onclick&&n.onclick(y)}),r(),i(n.value),s.textContent=n.name,m.appendChild(h),u.appendChild(s),u.appendChild(p),u.appendChild(m),y}function r(n,e,t){return{channel:n,pitch:e,velocity:t}}function c(n,e){function t(n){var e=n.data[0]>>4,t=r(15&n.data[0],n.data[1],n.data[2]);8===e||9===e&&0===t.velocity?c.emit("noteOff",t):9===e?c.emit("noteOn",t):11===e?c.emit("controllerChange",t):c.emit("sysex",n)}function o(n,t){e&&e.send([p[n]?p[n]+t.channel:t.channel,t.pitch,t.velocity])}function i(){n&&(n.onmidimessage=void 0),n=void 0,e=void 0,c.on=void 0,c.off=void 0,c.emit=void 0,c=void 0}if(!s)return null;if(!n&&!e)throw new Error("A bus needs a least an input or an output device");var c=u();return n&&(n.onmidimessage=t),c.send=o,c.destroy=i,c}function d(n){return s?m?n(null):void navigator.requestMIDIAccess().then(function(e){e.inputs.forEach(function(n){return h.push(n)}),e.outputs.forEach(function(n){return v.push(n)}),m=!0,n(null)},function(){n(new Error("No access to your midi devices."))}):null}function a(n){function e(){k=t(),C?m():p(),k.dom.appendChild(o().dom);for(var e in E){var i=E[e];k.dom.appendChild(i.dom)}n.append&&document.body.appendChild(k.dom)}function r(){h.forEach(function(n){var e=c(n);e.on("noteOn",function(t){return f(e,n.name,"noteOn",t)}),e.on("controllerChange",function(t){return f(e,n.name,"controllerChange",t)})})}function a(n,e){if(E[n])throw new Error("There is already a controller named "+n);e=Object.assign({},e,{name:n,onclick:l,emit:v.emit});var t=i(e);return E[n]=t,b&&y.main.appendChild(t),v}function l(n){x&&x.deselect(),x!==n?(n.select(),x=n):x=void 0}function f(n,e,t,o){x&&(x.affect(n,e,t,o),x.deselect(),x=void 0)}function p(){k.dom.style.display="none",C=!1}function m(){k.dom.style.display="block",C=!0}if(!s)throw new Error("Web MIDI API not supported on this browser");n=Object.assign({},g,n);var v=u();v.add=a,v.show=m,v.hide=p;var b=!1,y={},k=void 0,x=void 0,E={},C=!!n.visible;return d(function(){e(),r(),b=!0}),document.addEventListener("keyup",function(e){e.key===n.key&&(C?p():m())}),v}var u=n,l={primary:"#ffffff",primary2:"rgba(255, 255, 255, 0.4)",highlight:"#00f3e4",recording:"#dc3737",background:"#000000",background2:"#191919"},f={name:"No name",value:0},s=!!navigator.requestMIDIAccess,p={noteOn:128,noteOff:144},m=!1,h=[],v=[],g={append:!0,key:"m",visible:!0};return a});